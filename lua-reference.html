<html>
<head>
  <title>Massive Lua Reference v1.8</title>
  <link rel="stylesheet" type="text/css" href="styles/lua-reference.css" />
  <meta charset="utf-8" />
</head>
<body>
<h1>TPTElements - Lua reference</h1>
-- TPTElements for <a href="./index.html#cpp">C++</a> / <a href="./index.html#lua">Lua</a> / <a href="./index.html#c">C</a>
-- References for <a href="./lua-reference.html">The Lua API (and TPT internals, really)</a> / <a href="./OPS-reference.html">OPSv1</a> / <a href="./search.html">Lua API Search</a>
-- external stuff: <a href="http://github.com/boxmein/TPTElements/tree/backbone">on GitHub</a> / <a href="http://tpt.io/@boxmein">Contact</a> / <a href="http://powdertoy.co.uk/Wiki/W/Coding-tutorial.html">Coding tutorial</a> / <a href="http://powdertoy.co.uk">Powder Toy</a>
<div class="aside">
  <p>Links</p>
  <ul>
    <li><a id="bright" href="javascript:;">Bright mode</a></li>
    <li><a href="#">To the top!</a></li>
    <li><a href="#treetop">Treetop</a></li>
    <li><a href="#notes">Notes</a></li>
    <li><a href="#tpt">tpt.*</a></li>
    <li><a href="#elements">elements.*</a></li>
    <li><a href="#simulation">simulation.*</a></li>
    <li><a href="#renderer">renderer.*</a></li>
    <li><a href="#graphics">graphics.*</a></li>
    <li><a href="#fileSystem">fileSystem.*</a></li>
    <li><a href="#interface">interface.*</a></li>
    <li><a href="#bit">bit.*</a></li>
    <li><a href="#boolint">boolint ?!</a></li>
    <li><a href="#tpt.el">tpt.el.*</a></li>
    <li><a href="#elements.property">elements.property()</a></li>
    <li><a href="#particles">particles</a></li>
    <li><a href="#properties">properties</a></li>
    <li><a href="#tpt.el">tpt.el.*</a></li>
    <li><a href="#tpt.eltransition">tpt.eltransition.*</a></li>
    <li><a href="#properties.graphics_func">graphics_func</a></li>
    <li><a href="#properties.update_func">update_func</a></li>
  </ul>
</div>
<pre><code class="content">
luaref.txt
==========

The gigantic reference that gives you knowledge on literally everything that you
can do with The Powder Toy Lua! Improved all the time and gathered over the ages.


(really do use Ctrl+F, you'll find it less a pain to navigate)

<span class="brightonly">
The light! It burns us!
</span>


<span id="notes">Notes</span>
-----

* The tree below is pretty packed with information. The doc has long lines so it
  is suggested that you disable word wrap.
* <span class="editable" id="boolint">boolint</span> = integer that acts as a boolean (0 or 1)
* <span class="editable">number</span> = Lua's natural number type, = "real"
* <span class="editable">mixed</span> type means "whatever suits it there"
* <span class="editable">element</span> type is any valid element ID, either returned by tpt.element or just
  inbetween 0 and PT_NUM.

* I'll insert default values or other notes right next to the argument inside 
  brackets <span class="editable">[]</span>. 
* <span class="editable">d.</span> is short for default. 
* <span class="editable">1||2</span> in tpt.setwindowsize means that the correct
  value is either 1 or 2, <em>NOTHING</em> else.
* <span class="editable">0:255</span> means a value between 0 and 255.
* <span class="editable">NYI:</span> Not Yet Implemented

* If not explicitly noted, all color values have limits of <span class="editable">0 to 255</span> 
  (incl. firer/g/b, colr/g/b) and default to white.
* Extension to the above: all alpha values (firea/cola) have a limit of 100 as 
  the most opaque.

<span id="thats-the-spirit">* Hover on all sorts of tree nodes or keys to make your address bar display the
  direct link to it!</span>



<span id="treetop">The Big Tree</span>
------------

(global)
│
│
│  <span class="comment">Legacy Lua API</span>
│  <span class="comment">Most, if not every, methods here are covered in other APIs. </span>
│  <span class="comment">Except versions. Those are only accessible here.</span>
├ <span class="editable" id="tpt">tpt</span>
│ │
│ ├─ <span id="tpt.version">version</span> 
│ │  ├─ <span id="tpt.version.major">major</span>  <span class="comment">Major game version, for example 81</span>
│ │  ├─ <span id="tpt.version.minor">minor</span>  <span class="comment">Minor version, for example 0</span>
│ │  └─ <span id="tpt.version.build">build</span>  <span class="comment">Build version, for example 292</span>
│ │
│ ├─ <span id="tpt.parts">parts []</span> <span class="comment">Array of particles by index, emulates sim->parts in C++</span>
│ │
│ ├─ partsdata = nil <span class="comment">NYI</span>
│ │  
│ │  <span class="comment">Covered under <a href="#tpt.el">#properties</a> below.</span>
│ ├─ el
│ │  ├─ dust
│ │  └─ ...
│ │
│ ├─ <span id="tpt.test">test</span>                      () <span class="comment">Unknown </span>
│ ├─ <span id="tpt.drawtext">nil drawtext</span>              (int x, int y, string text) <span class="comment">Draws a text string only for the next frame</span>
│ │      ├─                    (int x, int y, string text, int r, int g, int b)
│ │      └─                    (int x, int y, string text, int r, int g, int b, int a)
│ │
│ ├─ <span id="tpt.create">int<span class="editable">[index]</span> create</span>         (int x, int y) <span class="comment">Creates a new particle at (x, y)</span>
│ ├─ <span id="tpt.set_pause">nil/int set_pause</span>         (boolint state) <span class="comment">Pauses/unpauses the game (1 = paused). -1 returns the paused state.</span>
│ ├─ <span id="tpt.toggle_pause">int toggle_pause</span>          () <span class="comment">Toggles pause for the game.</span>
│ ├─ <span id="tpt.set_console">nil set_console</span>           (boolint state) <span class="comment">Opens/closes the console (1 = open)</span>
│ ├─ <span id="tpt.log">nil log</span>                   (string text) <span class="comment">Logs to the console - precisely the thing on the right</span>
│ ├─ <span id="tpt.set_pressure">nil set_pressure</span>          (int x, int y, int width, int height, int value) <span class="comment">Sets pressure for given rectangle. <span class="editable">[wall coordinates]</span></span>
│ ├─ <span id="tpt.set_gravity">nil set_gravity</span>           (int x, int y) <span class="comment">Sets the Newtonian Gravity for a given position. </span>
│ │                            (int x, int y, int width, int height)
│ │                            (int x, int y, int width, int height, int value<span class="editable">[d. 0.0]</span>)
│ │
│ ├─ <span id="tpt.reset_gravity_field">nil reset_gravity_field</span>   (int x, int y) <span class="comment">Sets gravity at (x, y) to 0.0</span>
│ │      └─                    (int x, int y, int width, int height)
│ │
│ ├─ <span id="tpt.reset_velocity">nil reset_velocity</span>        (int x, int y) <span class="comment">Sets velocity (vx and vy) in the specified rectangle to 0</span>
│ │      └─                    (int x, int y, int width, int height)
│ │
│ ├─ <span id="tpt.reset_spark">nil reset_spark</span>           () <span class="comment">Converts SPRK(X) into X</span>
│ ├─ <span id="tpt.set_property">nil set_property</span>          (string property, mixed value) <span class="comment">Sets a property of an element <span class="editable">[affects every element]</span></span>
│ │      ├─                    (string property, mixed value, string type) <span class="comment"><span class="editable">[affects elements of 1 type]</span></span>
│ │      ├─                    (string property, mixed value, int index) <span class="comment"><span class="editable">[affects particle via index]</span></span>
│ │      ├─                    (string property, mixed value, int index, string type) <span class="comment"><span class="editable">[affects particle via index if it is of the specified type]</span></span>
│ │      ├─                    (string property, mixed value, int x, int y) <span class="comment"><span class="editable">[affects particle via position]</span></span>
│ │      ├─                    (string property, mixed value, int x, int y, string type) <span class="comment"><span class="editable">[affects particle via x/y if of the specified type]</span></span>
│ │      ├─                    (string property, mixed value, int x, int y, int width, int height) <span class="comment"><span class="editable">[affects region]</span></span>
│ │      └─                    (string property, mixed value, int x, int y, int width, int height, string type) <span class="comment"><span class="editable">[affects region if of the specified type]</span></span>
│ │
│ ├─ <span id="tpt.get_property">mixed get_property</span>        (string property, int index) <span class="comment">Returns some property of a given particle</span>
│ │        └─                  (string property, int x, int y) 
│ │
│ ├─ <span id="tpt.set_wallmap">nil set_wallmap</span>           (int x, int y, int value) <span class="comment">Place or change a wall at (x, y) to (value)</span>
│ │      └─ <span class="comment">NYI:            (int x, int y, int width, int height, int value)</span>
│ │
│ ├─ <span id="tpt.get_wallmap">int get_wallmap</span>           (int x, int y, <span class="editable">[NYI: int width, int height]</span>)   <span class="comment">Get the wall at <span class="editable">[wall coordinates!]</span> x, y</span>
│ ├─ <span id="tpt.set_elecmap">nil set_elecmap</span>           (int x, int y, int value) <span class="comment">Sets the sim-&gt;emap value for <span class="editable">[wall coordinate]</span> x, y</span>
│ │      └─                    (int x, int y, <span class="editable">[NYI:int width, int height,]</span> int value)
│ │
│ ├─ <span id="tpt.get_elecmap">int get_elecmap</span>           (int x, int y) <span class="comment">Returns the sim-&gt;emap value for <span class="editable">[wall coordinate]</span> x, y</span>
│ ├─ <span id="tpt.drawpixel">nil drawpixel</span>             (int x, int y) <span class="comment">Draws a pixel for the next frame</span>
│ │      ├─                    (int x, int y, int r, int g, int b)
│ │      └─                    (int x, int y, int r, int g, int b, int a)
│ │
│ ├─ <span id="tpt.drawrect">nil drawrect</span>              (int x, int y, int width, int height) <span class="comment">Draws a hollow rect for the next frame</span>
│ │      ├─                    (int x, int y, int width, int height, int red, int green, int blue)
│ │      └─                    (int x, int y, int width, int height, int red, int green, int blue, int alpha)
│ │
│ ├─ <span id="tpt.fillrect">nil fillrect</span>              (int x, int y, int width, int height) <span class="comment">Draws a filled rect for the next frame</span>
│ │      ├─                    (int x, int y, int width, int height, int red, int green, int blue)
│ │      └─                    (int x, int y, int width, int height, int red, int green, int blue, int alpha)
│ │
│ ├─ <span id="tpt.drawline">nil drawline</span>              (int x1, int y1, int x2, int y2) <span class="comment">Draws a line for the next frame</span>
│ │      ├─                    (int x1, int y1, int x2, int y2, int red, int green, int blue)
│ │      └─                    (int x1, int y1, int x2, int y2, int red, int green, int blue, int alpha)
│ │
│ ├─ <span id="tpt.textwidth">int textwidth</span>             (string text) <span class="comment">Find out the width of a string of text in the TPT font</span>
│ ├─ <span id="tpt.get_name">string get_name</span>           () <span class="comment">Returns username</span>
│ ├─ <span id="tpt.set_shortcuts">nil set_shortcuts</span>         (boolint state) <span class="comment">Enable/Disable key shortcuts</span>
│ ├─ <span id="tpt.delete">nil delete</span>                (int index) <span class="comment">Delete particle @ position/index</span>
│ │      └─                    (int x, int y)
│ │
│ ├─ <span id="tpt.register_step">nil register_step</span>         (function onTick) <span class="comment">Add a function to be run every tick. You can have 6 of these.</span>
│ ├─ <span id="tpt.unregister_step">nil unregister_step</span>       (function onTick) <span class="comment">Remove a given tick function to clean up the place. Ha!</span>
│ ├─ <span id="tpt.register_mouseclick">nil register_mouseclick</span>   (function onClick) <span class="comment">Add a function(int mousex, int mousey, int button, int event) to run on mouse click.</span>
│ ├─ <span id="tpt.unregister_mouseclick">nil unregister_mouseclick</span> (function onClick) <span class="comment">Remove a given click function</span>
│ ├─ <span id="tpt.register_keypress">nil register_keypress</span>     (function onKey) <span class="comment">Add a function to run on keypress. Arguments: char key, int keyCode, int modifierKeys, int event</span>
│ ├─ <span id="tpt.unregister_keypress">nil unregister_keypress</span>   (function onKey) <span class="comment">Remove a given key press function.</span>
│ ├─ <span id="tpt.register_mouseevent">nil register_mouseevent</span>   <span class="comment">= register_mouseclick</span>
│ ├─ <span id="tpt.unregister_mouseevent">nil unregister_mouseevent</span> <span class="comment">= unregister_mouseclick</span>
│ ├─ <span id="tpt.register_keyevent">nil register_keyevent</span>     <span class="comment">= register_keypress</span>
│ ├─ <span id="tpt.unregister_keyevent">nil unregister_keyevent</span>   <span class="comment">= register_keyevent</span>
│ ├─ <span id="tpt.input">string input</span>              (string title, string message) <span class="comment">Prompt the user for input and return the data as string. Like <a href="javascript:(prompt('This is a demo'),null)">prompt()</a></span>
│ ├─ <span id="tpt.message_box">nil message_box</span>           (string title, string message) <span class="comment">Show an user some information. Really generic. Like <a href="javascript:alert('Hello :D')">alert()</a></span>
│ ├─ <span id="tpt.get_numOfParts">int get_numOfParts</span>        () <span class="comment">Returns the particle count right now (a maximum of 235008)</span>
│ ├─ <span id="tpt.start_getPartIndex">nil start_getPartIndex</span>    () <span class="comment">Prepare getPartIndex in order to use the other two functions</span>
│ ├─ <span id="tpt.set_property">bool next_getPartIndex</span>    () <span class="comment">True if there's a particle ID to be returned by getPartIndex</span>
│ ├─ <span id="tpt.set_property">int<span class="editable">[index]</span> getPartIndex</span>   () <span class="comment">Returns the next used particle index (you can loop over this)</span>
│ ├─ <span id="tpt.hud">nil/int hud</span>               (boolint state) <span class="comment">Show/Hide the HUD. (1 = Show). -1 returns current state.</span>
│ ├─ <span id="tpt.newtonian_gravity">nil/int newtonian_gravity</span> (boolint state) <span class="comment">Set Newtonian Gravity. (1 = On). -1 returns current state.</span>
│ ├─ <span id="tpt.ambient_heat">nil/int ambient_heat</span>      (boolint state) <span class="comment">Set Ambient Heat. (1 = On) -1 returns current state.</span>
│ ├─ <span id="tpt.active_menu">nil/int active_menu</span>       (int menuID)     <span class="comment">Set active menu section. -1 returns current state.</span>
│ ├─ <span id="tpt.decorations_enable">nil/int decorations_enable</span>(boolint state) <span class="comment">Toggle decorations. (1 = On) -1 returns current state.</span>
│ ├─ <span id="tpt.display_mode">nil display_mode</span>          (int displayID)  <span class="comment">Set Display mode. </span>
│ ├─ <span id="tpt.throw_error">nil throw_error</span>           (string text) <span class="comment">Display a message with an error of your choosing.</span>
│ ├─ <span id="tpt.heat">nil/int heat</span>                  (boolint state) <span class="comment">Toggle Heat. (1 = On) -1 returns current state.</span>
│ ├─ <span id="tpt.setfire">nil setfire</span>               (int strength<span class="editable">[=1]</span>) <span class="comment">Set strength of fire effects</span>
│ ├─ <span id="tpt.setdebug">nil setdebug</span>              (int level) <span class="comment">Deprecated:  Set debug level. 1 is what pressing D produces, higher levels <em>used</em> to do something</span>
│ ├─ <span id="tpt.setfpscap">nil setfpscap</span>             (int maxFPS<span class="editable">[=60]</span>) <span class="comment">Set max FPS</span>
│ ├─ <span id="tpt.getscript">nil getscript</span>             (string author, string id) <span class="comment">Fetch a script from the TPT Script Index. The index has no known entries as of 2013-12-27.</span>
│ ├─ <span id="tpt.setwindowsize">nil setwindowsize</span>         (int scale<span class="editable">[=1||2, d. 1]</span>, boolint fullscreen<span class="editable">[=0]</span>) <span class="comment">Set window size (scaled and fullscreen)</span>
│ ├─ <span id="tpt.watertest">int watertest</span>             () <span class="comment">Toggle water equalization. Returns new state.</span>
│ ├─ <span id="tpt.screenshot">nil screenshot</span>            () <span class="comment">Take a screenshot and save it as screenshot_####.png</span>
│ ├─ <span id="tpt.element">int/string element</span>        (string element) <span class="comment">Return element ID from element name as string</span>
│ │             └─             (element id) <span class="comment">Return element name as string from element ID</span>
│ │
│ ├─ <span id="tpt.get_clipboard">string get_clipboard</span>      () <span class="comment">Returns the current clipboard data as text</span>
│ ├─ <span id="tpt.set_clipboard">nil set_clipboard</span>         (string data) <span class="comment">Sets the current clipboard data as text</span>
│ ├─ <span id="tpt.element_func">nil element_func</span>          (element id, function onElement) <span class="comment">Make a particle update function. <a href="#properties.update_func">#update_func</a></span>
│ │      └─                    (element id, function onElement, bool replace) <span class="comment">Replace the previous update function.</span>
│ │
│ └─ <span id="tpt.graphics_func">nil graphics_func</span>         (element id, function onDraw) <span class="comment">Make an element look fancy. <a href="#properties.graphics_func">#graphics_func</a></span>
│ 
│  <span class="comment" id="elements">Elements API</span>
│  <span class="comment">Everything to do with elements, adding them, modifying them, ...</span>
│  <span class="comment">--</span>
│  
├ <span class="editable">elements (elem)</span>
│ │ 
│ │  <span class="comment">Particle movement types in .properties</span>
│ ├─ <span id="elem.TYPE_PART">TYPE_PART</span> <span class="editable">0x00001</span>
│ ├─ <span id="elem.TYPE_LIQUID">TYPE_LIQUID</span> <span class="editable">0x00002</span>
│ ├─ <span id="elem.TYPE_SOLID">TYPE_SOLID</span> <span class="editable">0x00004</span>
│ ├─ <span id="elem.TYPE_GAS">TYPE_GAS</span> <span class="editable">0x00008</span>
│ ├─ <span id="elem.TYPE_ENERGY">TYPE_ENERGY</span> <span class="editable">0x00010</span>
│ │ 
│ │  <span class="comment">Particle properties</span>
│ ├─ <span id="elem.PROP_CONDUCTS">PROP_CONDUCTS</span> <span class="editable">0x00020</span>
│ ├─ <span id="elem.PROP_BLACK">PROP_BLACK</span> <span class="editable">0x00040</span>
│ ├─ <span id="elem.PROP_NEUTPENETRATE">PROP_NEUTPENETRATE</span> <span class="editable">0x00080</span>
│ ├─ <span id="elem.PROP_NEUTABSORB">PROP_NEUTABSORB</span> <span class="editable">0x00100</span>
│ ├─ <span id="elem.PROP_NEUTPASS">PROP_NEUTPASS</span> <span class="editable">0x00200</span>
│ ├─ <span id="elem.PROP_DEADLY">PROP_DEADLY</span> <span class="editable">0x00400</span>
│ ├─ <span id="elem.PROP_HOT_GLOW">PROP_HOT_GLOW</span> <span class="editable">0x00800</span>
│ ├─ <span id="elem.PROP_LIFE">PROP_LIFE</span> <span class="editable">0x01000</span>
│ ├─ <span id="elem.PROP_RADIOACTIVE">PROP_RADIOACTIVE</span> <span class="editable">0x02000</span>
│ ├─ <span id="elem.PROP_LIFE_DEC">PROP_LIFE_DEC</span> <span class="editable">0x04000</span>
│ ├─ <span id="elem.PROP_LIFE_KILL">PROP_LIFE_KILL</span> <span class="editable">0x08000</span>
│ ├─ <span id="elem.PROP_LIFE_KILL_DEC">PROP_LIFE_KILL_DEC</span> <span class="editable">0x10000</span>
│ ├─ <span id="elem.PROP_SPARKSETTLE">PROP_SPARKSETTLE</span> <span class="editable">0x20000</span>
│ ├─ <span id="elem.PROP_NOAMBHEAT">PROP_NOAMBHEAT</span> <span class="editable">0x40000</span>
│ │  <span class="comment">Applies the CLNE effect: drawing with the brush over CLNE sets CLNE's ctype to something</span>
│ ├─ <span id="elem.PROP_DRAWONCTYPE">PROP_DRAWONCTYPE</span> <span class="editable">0x80000</span>
│ │  <span class="comment">Doesn't allow the CLNE effect to apply with this element</span>
│ ├─ <span id="elem.PROP_NOCTYPEDRAW">PROP_NOCTYPEDRAW</span> <span class="editable">0x100000</span>
│ │ 
│ │  <span class="comment">.flags for how often update happens etcetera</span>
│ ├─ <span id="elem.FLAG_STAGNANT">FLAG_STAGNANT</span> <span class="editable">0x1</span> <span class="comment">Update a bit less than usually</span>
│ ├─ <span id="elem.FLAG_SKIPMOVE">FLAG_SKIPMOVE</span> <span class="editable">0x2</span> <span class="comment">Don't do movement checks</span>
│ ├─ <span id="elem.FLAG_MOVABLE">FLAG_MOVABLE</span> <span class="editable">0x8</span> 
│ │ 
│ │  <span class="comment">.state values - element states</span>
│ ├─ <span id="elem.ST_NONE">ST_NONE</span> <span class="editable">0</span>
│ ├─ <span id="elem.ST_SOLID">ST_SOLID</span> <span class="editable">1</span>
│ ├─ <span id="elem.ST_LIQUID">ST_LIQUID</span> <span class="editable">2</span>
│ ├─ <span id="elem.ST_GAS">ST_GAS</span> <span class="editable">3</span>
│ │ 
│ │  <span class="comment">Element categories in the menu</span>
│ ├─ <span id="elem.SC_WALL">SC_WALL</span> <span class="editable">0</span>
│ ├─ <span id="elem.SC_ELEC">SC_ELEC</span> <span class="editable">1</span>
│ ├─ <span id="elem.SC_POWERED">SC_POWERED</span> <span class="editable">2</span>
│ ├─ <span id="elem.SC_SENSOR">SC_SENSOR</span> <span class="editable">3</span>
│ ├─ <span id="elem.SC_FORCE">SC_FORCE</span> <span class="editable">4</span>
│ ├─ <span id="elem.SC_EXPLOSIVE">SC_EXPLOSIVE</span> <span class="editable">5</span>
│ ├─ <span id="elem.SC_GAS">SC_GAS</span> <span class="editable">6</span>
│ ├─ <span id="elem.SC_LIQUID">SC_LIQUID</span> <span class="editable">7</span>
│ ├─ <span id="elem.SC_POWDERS">SC_POWDERS</span> <span class="editable">8</span>
│ ├─ <span id="elem.SC_SOLIDS">SC_SOLIDS</span> <span class="editable">9</span>
│ ├─ <span id="elem.SC_NUCLEAR">SC_NUCLEAR</span> <span class="editable">10</span>
│ ├─ <span id="elem.SC_SPECIAL">SC_SPECIAL</span> <span class="editable">11</span>
│ ├─ <span id="elem.SC_LIFE">SC_LIFE</span> <span class="editable">12</span>
│ ├─ <span id="elem.SC_TOOL">SC_TOOL</span> <span class="editable">13</span>
│ ├─ <span id="elem.SC_DECO">SC_DECO</span> <span class="editable">14</span>
│ │ 
│ │  <span class="comment">Element IDs - one for every default element, as well as Lua elements according to namespace</span>
│ ├─ <span id="elem.DEFAULT_PT_">DEFAULT_PT_<span class="editable">[DUST]</span></span>
│ │
│ ├─ <span id="elem.allocate">int allocate</span>              (string namespace, string name) <span class="comment">Sets up a space for a new element. Returns new element ID. </span>
│ │  <span class="comment">Creates key elements.NAMESPACE_PT_NAME for the ID. </span>
│ ├─ <span id="elem.free">nil free</span>                  (int elementID) <span class="comment">Deletes a given element from existence.</span>
│ ├─ <span id="elem.loadDefault">nil loadDefault</span>           () <span class="comment">Deletes all new elements. Restores all default elements.</span>
│ ├─ <span id="elem.element">nil/table element</span>         (int elementID) <span class="comment">Returns a table with the element's properties, to modify and set further on</span>
│ │            └─              (int elementID, table properties) <span class="comment">Sets _all_ the properties of an element to ones from the table. Useful for element cloning.</span>
│ └─ <span id="elem.property">nil/mixed property</span>        (int elementID, string property) <span class="comment">Returns an element's single property.</span>
│              └─              (int elementID, string property, mixed value) <span class="comment">Sets an element's single property to value.</span>
│
│  <span class="comment" id="simulation">Simulation API</span>
│  <span class="comment">Everything to do with particles, pressure, heat, gravity, resetting temperature, whatnot.</span>
│  
│  
├ <span class="editable">simulation (sim)</span>
│ │
│ ├─ <span id="sim.partNeighbours">table partNeighbours</span>      (int x, int y, int radius) <span class="comment">Find list of particles around a center location, in a given radius.</span>
│ │        partNeighbors       (int x, int y, int radius, int type) <span class="comment">Filter for an element with a certain type too.</span>
│ ├─ <span id="sim.partChangeType">nil partChangeType</span>        (int index, int type) <span class="comment">Change particle type. Better than setting .type - </span>
│ │                                                  <span class="comment">some elements need special properties to work and this will set them</span>
│ ├─ <span id="sim.partCreate">nil partCreate</span>            (int x, int y, int type) <span class="comment">Create a particle.</span>
│ ├─ <span id="sim.partProperty">nil/mixed partProperty</span>    (int index, string field) <span class="comment">Get/set a property on a particle. Like tpt.get_property only better.</span>
│ │            └─              (int index, string field, mixed value) 
│ ├─ <span id="partPosition">int, int partPosition</span>     (int index) <span class="comment">Get x,y from a given particle index</span>
│ ├─ <span id="sim.partID">int partID</span>                (int x, int y) <span class="comment">Get index from a pair of coordinates (x, y)</span>
│ ├─ <span id="sim.partKill">nil partKill</span>              (int index) <span class="comment">Delete a particle properly</span>
│ │      └─                    (int x, int y)
│ ├─ <span id="sim.pressure">nil/int pressure</span>          (int x, int y) <span class="comment">Get/set pressure at <span class="editable">[wall coordinates]</span> x,y</span>
│ │          ├─                (int x, int y, int value)
│ │          └─                (int x, int y, int width, int height, int value)
│ ├─ <span id="sim.ambientHeat">nil/int ambientHeat</span>       (int x, int y) <span class="comment">Get/set ambient heat at <span class="editable">[wall coordinates]</span> x,y</span>
│ │          ├─                (int x, int y, int value)
│ │          └─                (int x, int y, int width, int height, int value)
│ ├─ <span id="sim.velocityX">nil/int velocityX</span>         (int x, int y) <span class="comment">Get/set velocity (x) at <span class="editable">[wall coordinates]</span> x,y</span>
│ │          ├─                (int x, int y, int value)
│ │          └─                (int x, int y, int width, int height, int value)
│ ├─ <span id="sim.velocityY">nil/int velocityY</span>         (int x, int y) <span class="comment">Get/set velocity (y) at <span class="editable">[wall coordinates]</span> x,y</span>
│ │          ├─                (int x, int y, int value)
│ │          └─                (int x, int y, int width, int height, int value)
│ ├─ <span id="sim.gravMap">nil/int gravMap</span>           (int x, int y) <span class="comment">Get/set gravity at <span class="editable">[wall coordinates]</span> x,y</span>
│ │          ├─                (int x, int y, int value)
│ │          └─                (int x, int y, int width, int height, int value)
│ ├─ <span id="sim.createParts">int createParts</span>           (int cx, int cy, int rx<span class="editable">[=d. 5]</span>, int ry<span class="editable">[=d. 5]</span>, 
│ │                             int type<span class="editable">[=d. selectedl]</span>, int brush<span class="editable">[=d. circle]</span>, int flags<span class="editable">[=d. replace flags]</span>) 
│ │                             <span class="comment">Creates multiple particles (like drawing with a brush!) </span>
│ │                             <span class="comment">Set rx and ry to horizontal and vertical radius (ellipse brush). Returns how many particles were changed.</span>
│ ├─ <span id="sim.createLine">int createLine</span>            (int x1, int y1, int x2, int y2, int rx, int ry, <span class="comment">Create line with createParts. Returns how many particles were changed.</span>
│ │                             int type<span class="editable">[=d. selectedl]</span>, int brush<span class="editable">[=d. circle]</span>, int flags<span class="editable">[=d. replace flags]</span>)
│ ├─ <span id="sim.createBox">int createBox</span>             (int x1, int y1, int x2, int y2, int type<span class="editable">[=d. selectedl]</span>, int flags<span class="editable">[=d. replace flags]</span>) <span class="comment">Filled box. Returns how many particles were changed.</span>
│ ├─ <span id="sim.floodParts">int floodParts</span>            (int x, int y, int type, int cm, int flags<span class="editable">[=d. replace flags]</span>) <span class="comment">Flood fill particles. Returns how many particles were changed.</span>
│ ├─ <span id="sim.createWalls">int createWalls</span>           (int cx, int cy, int rx<span class="editable">[=d. 0]</span>, int ry<span class="editable">[=d. 0]</span>, int type<span class="editable">[=d. 8]</span>) <span class="comment">Create walls. </span>
│ │  <span class="comment">(wall types go from right to left, 1 for rightmost not delete). Returns how many particles were changed.</span>
│ ├─ <span id="sim.createWallLine">nil createWallLine</span>        (int x1, int y1, int x2, int y2, int rx, int ry, int type<span class="editable">[=d. 8]</span>) <span class="comment">Create line with createParts                     </span>
│ ├─ <span id="sim.createWallBox">nil createWallBox</span>         (int x1, int y1, int x2, int y2, int type<span class="editable">[=d. 8]</span>) <span class="comment">Wall boxes!</span>
│ ├─ <span id="sim.floodWalls">int floodWalls</span>            (int x, int y, int type<span class="editable">[=d. 8]</span>, int bm) <span class="comment">Flood-fill walls! Returns how many particles were changed.</span>
│ ├─ <span id="sim.toolBrush">int toolBrush</span>             (int x, int y, int rx, int ry, int tool, int brush<span class="editable">[=d. circle]</span>) <span class="comment">Apply a tool (AIR, VACU, GRAV, HEAT)</span>
│ ├─ <span id="sim.toolLine">nil toolLine</span>              (int x1, int y1, int x2, int y2, int rx, int ry, int tool, int brush<span class="editable">[=d. circle]</span>) <span class="comment">Tool brush with line</span>
│ ├─ <span id="sim.toolBox">nil toolBox</span>               (int x1, int y1, int x2, int y2, int tool, float strength<span class="editable">[=d. 1.0]</span>) <span class="comment">Tool via box</span>
│ ├─ <span id="sim.decoBrush">nil decoBrush</span>             (int x, int y, int rx, int ry, int r, int g, int b, int a, int tool<span class="editable">[=d. DECO_DRAW]</span>, int brush<span class="editable">[=d. circle]</span>) <span class="comment">Draw decorations</span>
│ ├─ <span id="sim.decoLine">nil decoLine</span>              (int x, int y, int rx, int ry, int r, int g, int b, int a, int tool<span class="editable">[=d. DECO_DRAW]</span>, int brush<span class="editable">[=d. circle]</span>)
│ ├─ <span id="sim.decoBox">nil decoBox</span>               (int x1, int y1, int x2, int y2, int r, int g, int b, int a, int tool) <span class="comment">Draw a box of decorations.</span>
│ ├─ <span id="sim.decoColor">nil decoColor</span>             () <span class="comment">Get/Set currently selected deco colour (0xAARRGGBB)</span>
│ │      └─ = nil decoColour   (int colour<span class="editable">[=d. 0xFFFF0000]</span>)
│ ├─ <span id="sim.clearSim">nil clearSim</span>              () <span class="comment">Clear everything on the save</span>
│ ├─ <span id="sim.resetTemp">nil resetTemp</span>             () <span class="comment">Resets heat of every particle to room temperature (optionally, only metals et al)</span>
│ │      └─                    (boolint onlyConductives)
│ │
│ ├─ <span id="sim.resetPressure">nil resetPressure</span>         () <span class="comment">Resets pressure everywhere, or at (x, y), or as a box</span>
│ │      ├─                    (int x, int y)  
│ │      └─                    (int x1, int y1, int width, int height)
│ │
│ ├─ <span id="sim.saveStamp">string saveStamp</span>          (int x, int y, int width, int height) <span class="comment">Saves a stamp and returns its cryptic name</span>
│ ├─ <span id="sim.loadStamp">nil/int loadStamp</span>         (mixed id, int x, int y) <span class="comment">Loads a stamp by its cryptic name and places it at x, y. </span>
│ │  <span class="comment">The ID can either be char<span class="editable">[10]</span> or integer. 1 if not OK, nil otherwise.</span>
│ ├─ <span id="sim.loadSave">nil loadSave</span>              (int saveID, int timehistory) <span class="comment">Loads a save or its previous variant at the time (in exact seconds!) it was saved.</span>
│ ├─ <span id="sim.getSaveID">nil/int getSaveID</span>         () <span class="comment">Returns the current save's ID.</span>
│ ├─ <span id="sim.adjustCoords">int, int adjustCoords</span>     (int x, int y) <span class="comment">Set zoom window coordinates to here</span>
│ ├─ <span id="sim.prettyPowders">nil/int prettyPowders</span>     () <span class="comment">Gets/Sets the powder noise thing</span>
│ │          └─                (boolint state)
│ ├─ <span id="sim.gravityGrid">nil/int gravityGrid</span>       () <span class="comment">Gets/Sets the gravity dot thing</span>
│ │          └─                (boolint state)
│ ├─ <span id="sim.edgeMode">nil/int edgeMode</span>          () <span class="comment">Gets/Sets the edge mode. 0 = Void. 1 = Solid.</span>
│ │          └─                (int mode)
│ ├─ <span id="sim.gravityMode">nil/int gravityMode</span>       () <span class="comment">Gets/Sets gravity mode. Vertical, Radial, Off, in some order.</span>
│ │          └─                (int mode)
│ ├─ <span id="sim.airMode">nil/int airMode</span>           () <span class="comment">Gets/Sets the air mode. On, No Velocity, No Pressure, No Update, Off in some order.</span>
│ │          └─                (int mode)
│ ├─ <span id="sim.waterEqualisation">nil/boolint waterEqualisation</span> () <span class="comment">Gets/Sets water equalization.</span>
│ │              └─ = waterEqualization (boolint state) 
│ ├─ <span id="sim.ambientAirTemp">nil/int ambientAirTemp</span>    () <span class="comment">Gets/Sets Ambient Heat mode's air temperature. Default: 293.15</span>
│ │          └─                (int temp)
│ │ 
│ ├─ <span id="sim.canMove">nil/int canMove</span>           (int src, int dst) <span class="comment">Gets/Sets what happens when element with ID (src) and element with ID (dst) try and move through each other</span>
│ │          └─                (int src, int dst, int new_value) <span class="comment">Similar to C++ can_move[src][dst] - check out <a href="https://github.com/simtr/The-Powder-Toy/blob/master/src/simulation/Simulation.cpp#L1932">Simulation.cpp</a></span>
│ │                                                              <span class="comment">0 = no move / bounce back, eg AMTR trying to move onto DMND</span>
│ │                                                              <span class="comment">1 = swap particle locations, eg BHOL swaps elements into itself and then eats them </span>
│ │                                                              <span class="comment">2 = two particles in the same space, eg two energy particles crossing</span>
│ │                                                              <span class="comment">3 = other/handled elsewhere, eg PHOT trying to move into LCRY is actually handled in some update function</span>
│ │ 
│ ├─ <span id="sim.elementCount">int elementCount</span>          (element type) <span class="comment">Returns how many particles have this type on the screen.</span>
│ ├─ <span id="sim.parts">iter parts</span>                () <span class="comment">Returns an iterator returning existing element indexes which you can <span class="editable">for index in sim.parts()</span> over.</span>
│ ├─ <span id="sim.pmap">int16 pmap</span>                (int x, int y) <span class="comment">Returns the sim->pmap entry for a given location. The entry looks like index &gt;&gt; 8 | type</span>
│ └─ <span id="sim.neighbours">iter neighbours</span>                (int x, int y, int rx, int ry) <span class="comment">Returns an object which you can for..in over, returning neighbor particles.  </span>
│         └─ = neighbors
│
│  <span class="comment" id="renderer">Renderer API</span>
│  <span class="comment">Everything to do with how particles look.</span>
│
│
├ <span class="editable">renderer (ren) </span>
│ │
│ │  <span class="comment">Pixel drawing modes. See <a href="http://powdertoy.co.uk/System/External/MediaWiki/images/a/a3/Particle_Drawing_Modes.png">Particle_Drawing_Modes.png</a> for a quick reference.</span>
│ ├─ <span id="ren.PMODE">PMODE </span><span class="editable">0x00000FFF</span>         <span class="comment">Bitmask to get display modes via binary AND</span>
│ ├─ <span id="ren.PMODE">PMODE_NONE </span><span class="editable">0x00000000</span>    <span class="comment">Invisible as in totally invisible</span>
│ ├─ <span id="ren.PMODE">PMODE_FLAT </span><span class="editable">0x00000001</span>    <span class="comment">Regular like Basic view</span>
│ ├─ <span id="ren.PMODE">PMODE_BLOB </span><span class="editable">0x00000002</span>    <span class="comment">Blurry like Blob view</span>
│ ├─ <span id="ren.PMODE">PMODE_BLUR </span><span class="editable">0x00000004</span>    <span class="comment">Blurry like wtrv</span>
│ ├─ <span id="ren.PMODE">PMODE_GLOW </span><span class="editable">0x00000008</span>    <span class="comment">Glowy like PLUT with fancy view</span>
│ ├─ <span id="ren.PMODE">PMODE_SPARK </span><span class="editable">0x00000010</span>   <span class="comment">Sparks used to be drawn more fancily</span>
│ ├─ <span id="ren.PMODE">PMODE_FLARE </span><span class="editable">0x00000020</span>   <span class="comment">Flare like BOMB</span>
│ ├─ <span id="ren.PMODE">PMODE_LFLARE </span><span class="editable">0x00000040</span>  <span class="comment">Large flare like DEST</span>
│ ├─ <span id="ren.PMODE">PMODE_ADD </span><span class="editable">0x00000080</span>     <span class="comment">If particles are stacking then adds up the colours</span>
│ ├─ <span id="ren.PMODE">PMODE_BLEND </span><span class="editable">0x00000100</span>   <span class="comment">Weaker than the above, does blendy magic.</span>
│ │
│ ├─ <span id="ren.PSPEC_STICKMAN">PSPEC_STICKMAN </span><span class="editable">0x00000200</span> <span class="comment">Only works for STKM, shows them as STKM</span>
│ ├─ <span id="ren.OPTIONS">OPTIONS</span> <span class="editable">0x0000F000</span>        <span class="comment">A bit mask for the option bit. If you're making a custom render mode just always involve this.</span>
│ ├─ <span id="ren.NO_DECO">NO_DECO</span> <span class="editable">0x00001000</span>        <span class="comment">politely refuses decorations be drawn upon it (like LCRY)</span>
│ │
│ ├─ <span id="ren.DECO_FIRE">DECO_FIRE</span> <span class="editable">0x00002000</span>      <span class="comment">enables changing the blur colour via deco</span>
│ ├─ <span id="ren.FIREMODE">FIREMODE</span> <span class="editable">0x00FF0000</span>       <span class="comment">Bit mask for fire modes (below)</span>
│ ├─ <span id="ren.FIRE_ADD">FIRE_ADD</span> <span class="editable">0x00100000</span>       <span class="comment">A pixel mode that makes it drawn like a fire particle. </span>
│ ├─ <span id="ren.FIRE_BLEND">FIRE_BLEND</span> <span class="editable">0x00200000</span>     <span class="comment">^ with blendy magic.</span>
│ │
│ ├─ <span id="ren.EFFECT">EFFECT</span> <span class="editable">0xFF000000</span>
│ ├─ <span id="ren.EFFECT_GRAVIN">EFFECT_GRAVIN</span> <span class="editable">0x01000000</span>  <span class="comment">Enables what PRTI does (particle sucky effect), however more life/ctype magic may be needed</span>
│ ├─ <span id="ren.EFFECT_GRAVOUT">EFFECT_GRAVOUT</span> <span class="editable">0x02000000</span> <span class="comment">^ for PRTO</span>
│ ├─ <span id="ren.EFFECT_LINES">EFFECT_LINES</span> <span class="editable">0x04000000</span>
│ ├─ <span id="ren.EFFECT_DBGLINES">EFFECT_DBGLINES</span> <span class="editable">0x08000000</span>
│ │  <span class="comment">Render mode flags all bundled up together</span> 
│ ├─ <span id="ren.RENDER_EFFE">RENDER_EFFE </span><span class="editable">OPTIONS | PSPEC_STICKMAN | EFFECT | PMODE_SPARK | PMODE_FLARE | PMODE_LFLARE</span>
│ ├─ <span id="ren.RENDER_FIRE">RENDER_FIRE </span><span class="editable">OPTIONS | PSPEC_STICKMAN | <span class="comment nodash">/*PMODE_FLAT |*/</span> PMODE_ADD | PMODE_BLEND | FIREMODE</span>
│ ├─ <span id="ren.RENDER_GLOW">RENDER_GLOW </span><span class="editable">OPTIONS | PSPEC_STICKMAN | <span class="comment nodash">/*PMODE_FLAT |*/</span> PMODE_GLOW | PMODE_ADD | PMODE_BLEND</span>
│ ├─ <span id="ren.RENDER_BLUR">RENDER_BLUR </span><span class="editable">OPTIONS | PSPEC_STICKMAN | <span class="comment nodash">/*PMODE_FLAT |*/</span> PMODE_BLUR | PMODE_ADD | PMODE_BLEND</span>
│ ├─ <span id="ren.RENDER_BLOB">RENDER_BLOB </span><span class="editable">OPTIONS | PSPEC_STICKMAN | <span class="comment nodash">/*PMODE_FLAT |*/</span> PMODE_BLOB | PMODE_ADD | PMODE_BLEND</span>
│ ├─ <span id="ren.RENDER_BASC">RENDER_BASC </span><span class="editable">OPTIONS | PSPEC_STICKMAN | PMODE_FLAT | PMODE_ADD | PMODE_BLEND | EFFECT_LINES</span>
│ ├─ <span id="ren.RENDER_NONE">RENDER_NONE </span><span class="editable">OPTIONS | PSPEC_STICKMAN | PMODE_FLAT</span>
│ │
│ │  <span class="comment">What particle colors get drawn like - heat view or regular or whatnot</span>
│ ├─ <span id="ren.COLOUR_HEAT">COLOUR_HEAT    </span><span class="editable">0x0000001</span>    <span class="comment">This is like Heat view.</span>
│ ├─ <span id="ren.COLOUR_LIFE">COLOUR_LIFE    </span><span class="editable">0x0000002</span>    <span class="comment">Like Life display </span>
│ ├─ <span id="ren.COLOUR_GRAD">COLOUR_GRAD    </span><span class="editable">0x0000004</span>    <span class="comment">Like Heat Gradient display</span>
│ ├─ <span id="ren.COLOUR_BASC">COLOUR_BASC    </span><span class="editable">0x0000008</span>    <span class="comment">Like Basic display</span>
│ ├─ <span id="ren.COLOUR_DEFAULT">COLOUR_DEFAULT </span><span class="editable">0x00000000</span> <span class="comment">Default whatever</span>
│ │
│ ├─ <span id="ren.DISPLAY_AIRC">DISPLAY_AIRC </span><span class="editable">0x00000001</span>  
│ ├─ <span id="ren.DISPLAY_AIRP">DISPLAY_AIRP </span><span class="editable">0x00000002</span>   <span class="comment">Display air pressure</span>
│ ├─ <span id="ren.DISPLAY_AIRV">DISPLAY_AIRV </span><span class="editable">0x00000004</span>   <span class="comment">Display air velocity</span>
│ ├─ <span id="ren.DISPLAY_AIRH">DISPLAY_AIRH </span><span class="editable">0x00000008</span>   <span class="comment">Display air heat</span>
│ ├─ <span id="ren.DISPLAY_AIR">DISPLAY_AIR  </span><span class="editable">0x0000000F</span>
│ ├─ <span id="ren.DISPLAY_WARP">DISPLAY_WARP </span><span class="editable">0x00000010</span>   <span class="comment">Enable gravity wells</span>
│ ├─ <span id="ren.DISPLAY_PERS">DISPLAY_PERS </span><span class="editable">0x00000020</span>   <span class="comment">Display Persistent lines</span>
│ ├─ <span id="ren.DISPLAY_EFFE">DISPLAY_EFFE </span><span class="editable">0x00000040</span>
│ │
│ ├─ <span id="ren.renderModes">nil/table renderModes</span>     () <span class="comment">Get/set the render mode table</span>
│ │            └─              (table renderModeTable) 
│ ├─ <span id="ren.displayModes">nil/table displayModes</span>    () <span class="comment">Get/set the display mode table</span>
│ │            └─              (table displayModeTable) 
│ ├─ <span id="ren.colourMode">nil/int colourMode</span>        () <span class="comment">Get/set color mode</span>
│ │  colorMode                 (int colourMode) 
│ ├─ <span id="ren.decorations">nil/boolint decorations</span>   () <span class="comment">Get or set whether decorations are enabled.</span>
│ │              └─            (boolint state)
│ ├─ <span id="ren.grid">nil/int grid</span>              () <span class="comment">Get or set the grid display size</span>
│ │          └─                (int size) 
│ └─ <span id="ren.debugHUD">nil/int debugHUD</span>          () <span class="comment">Get/set whether or not debug HUD is visible. Replacement for tpt.setdebug</span>
│            └─                (int level)
│  
│  <span class="comment" id="graphics">Graphics API</span>
│  <span class="comment">Drawing other stuff onto the screen, like text or boxes.</span>
│  <span class="comment">--</span>
│  
├ <span class="editable">graphics (gfx)</span>
│ │ 
│ ├─ <span id="gfx.WIDTH">WIDTH</span> <span class="comment">YRES (384) + MENUSIZE</span>
│ ├─ <span id="gfx.HEIGHT">HEIGHT</span> <span class="comment">XRES (612) + BARSIZE</span>
│ │ 
│ ├─ <span id="gfx.textSize">int textSize</span>              (string text) <span class="comment">Get the width of a string when it's drawn in TPT's font </span>
│ ├─ <span id="gfx.drawText">nil drawText</span>              (int x, int y, string text) <span class="comment">Draw text for one frame = tpt.drawtext</span>
│ │      └─                    (int x, int y, string text, int r, int g, int b, int a)
│ │ 
│ ├─ <span id="gfx.drawLine">nil drawLine</span>              (int x1, int x2, int y1, int y2) <span class="comment">Draws a line for one frame</span>
│ │      └─                    (int x1, int y1, int x2, int y2, int r, int g, int b, int a)
│ ├─ <span id="gfx.drawRect">nil drawRect</span>              (int x, int y, int width, int height) <span class="comment">Draws a hollow rect for the next frame</span>
│ │      └─                    (int x, int y, int width, int height, int r, int g, int b)
│ ├─ <span id="gfx.fillRect">nil fillRect</span>              (int x, int y, int width, int height) <span class="comment">Draws a filled rect for the next frame</span>
│ │      └─                    (int x, int y, int width, int height, int r, int g, int b, int a)
│ ├─ <span id="gfx.drawCircle">nil drawCircle</span>            (int cx, int cy, int rx, int ry) <span class="comment">Draws an ellipse with two radiuses and a center point</span>
│ │      └─                    (int cx, int cy, int rx, int ry, int r, int g, int b, int a)
│ └─ <span id="gfx.fillCircle">nil fillCircle</span>            (int cx, int cy, int rx, int ry) <span class="comment">Draws an ellipse with two radiuses and a center point</span>
│        └─                    (int cx, int cy, int rx, int ry, int r, int g, int b, int a)
│ 
│  <span class="comment" id="fileSystem">Filesystem API</span>
│  <span class="comment">Used to secretly upload people's powder.pref onto a public server.</span>
│  
├ <span class="editable">fileSystem (fs)</span>
│ │ 
│ ├─ <span id="fs.list">nil/table list</span>            (string folder) <span class="comment">Lists the contents of a directory, be it other directories or files.</span>
│ ├─ <span id="fs.exists">bool exists</span>               (string path) <span class="comment">Checks if a file exists</span>
│ ├─ <span id="fs.isFile">bool isFile</span>               (string path) <span class="comment">Checks if the directory entry is a file (not a directory!)</span>
│ ├─ <span id="fs.isDirectory">bool isDirectory</span>          (string path) <span class="comment">Checks if the directory entry is a directory (not a file!)</span>
│ ├─ <span id="fs.makeDirectory">bool makeDirectory</span>        (string path) <span class="comment">Returns true on success.</span>
│ ├─ <span id="fs.removeDirectory">bool removeDirectory</span>      (string path) <span class="comment">Returns true on success.</span>
│ ├─ <span id="fs.removeFile">bool removeFile</span>           (string path) <span class="comment">Returns true on success.</span>
│ ├─ <span id="fs.move">bool move</span>                 (string path, string newPath)
│ └─ <span id="fs.copy">bool copy</span>                 (string path, string newPath)
│ 
│  <span class="comment" id="interface">Interface API</span>
│  <span class="comment">We apologize for the inconvenience.</span>
│ 
├ <span class="editable">interface (ui)</span>
│ │ 
│ ├─ <span id="ui.showWindow">nil showWindow</span>                (Window w) <span class="comment">Opens a Window.</span>
│ ├─ <span id="ui.closeWindow">nil closeWindow</span>               (Window w) <span class="comment">Closes a Window.</span>
│ ├─ <span id="ui.addComponent">nil addComponent</span>              (Component c) <span class="comment">Adds a Component to the main window.</span>
│ ├─ <span id="ui.removeComponent">nil removeComponent</span>           (Component c) <span class="comment">Removes a Component from the main window.</span>
│ │  
│ ├─ <span class="editable" id="ui.Component">Component</span> <span class="comment">Generic class for utilities</span>
│ │  ├─ <span id="ui.Component:visible"> nil / bool :visible</span>      () <span class="comment">Gets/sets whether the component is visible</span>
│ │  │              └─            (bool visible)
│ │  │
│ │  ├─ <span id="ui.Component:size"> nil / int,int :size</span>      () <span class="comment">Gets/sets the component's size</span>
│ │  │                 └─         (int width, int height)
│ │  │
│ │  └─ <span id="ui.Component:position"> nil / int,int :position</span>  () <span class="comment">Gets/sets the component's position</span>
│ │                    └─         (int x1, int y1)
│ │ 
│ ├─ <span class="editable" id="ui.Button">Button</span>
│ │  │
│ │  ├─ <span id="ui.Button:new">Button :new</span>            (int x, int y, int width, int height) <span class="comment">Creates a new button. Event listener needs to be attached later.</span>
│ │  │         └─              (int x, int y, int width, int height, string text, string tooltip)
│ │  ├─ <span id="ui.Button:action">nil :action</span>            (function onClick) <span class="comment">Attaches an event listener. Arguments: Button sender</span>
│ │  ├─ <span id="ui.Button:text">nil/string :text</span>       () <span class="comment">Gets/sets the button's text</span>
│ │  │             └─          (string text) 
│ │  └─ <span id="ui.Button:enabled">nil/bool :enabled</span>      () <span class="comment">Get/set the button's enabled state</span>
│ │              └─            (bool state) 
│ │
│ ├─ <span class="editable" id="ui.ProgressBar">ProgressBar</span>
│ │  │
│ │  │
│ │  ├─ <span id="ui.Progressbar:new">ProgressBar :new</span>       (int x, int y, int width, int height, int progress, string status) <span class="comment">Creates a new instance.</span>
│ │  ├─ <span id="ui.Progressbar:new">nil/int :progress</span>      () <span class="comment">Gets/sets the progress bar progress <span class="editable">[0:100]</span> -1 makes it scroll right slowly.</span>
│ │  │          └─             (int progress) 
│ │  └─ <span id="ui.Progressbar:new">nil/string :status</span>     () <span class="comment">Gets/sets the progress bar's status text.</span>
│ │                └─          (string status)
│ │ 
│ ├─ <span class="editable" id="ui.Slider">Slider</span>
│ │  │
│ │  ├─ <span id="ui.Slider:new">Slider :new</span>            (int x, int y, int width, int height) <span class="comment">Creates a new instance. Specify the event listener and handler later on.</span>
│ │  ├─ <span id="ui.Slider:onValueChanged">nil :onValueChanged</span>    (function onChange) <span class="comment">Attaches a onChanged event handler. Arguments: sender, value</span>
│ │  ├─ <span id="ui.Slider:value">nil/int :value</span>         () <span class="comment">Gets/sets its value. </span>
│ │  │          └─             (int value) 
│ │  └─ <span id="ui.Slider:steps">nil/int :steps</span>         () <span class="comment">Gets/sets the amount of 'steps' the slider has.</span>
│ │             └─             (int steps) 
│ │ 
│ ├─ <span class="editable" id="ui.Checkbox">Checkbox</span>
│ │  │
│ │  ├─ <span id="ui.Checkbox:new">Checkbox :new</span>          (int x, int y, int width, int height, <span class="editable">[string text = ""]</span>) <span class="comment">Creates a new instance.</span>
│ │  ├─ <span id="ui.Checkbox:action">nil :action</span>            (function onAction) <span class="comment">Arguments: sender, value</span>
│ │  ├─ <span id="ui.Slider:text">nil/string :text</span>       () <span class="comment">Gets/sets its text. </span>
│ │  │             └─          (string text) 
│ │  └─ <span id="ui.Slider:checked">nil/int :checked</span>       () <span class="comment">Gets/sets its checked state. </span>
│ │             └─             (int checked) 
│ │    
│ │ 
│ ├─ <span class="editable" id="ui.Label">Label</span>
│ │  │
│ │  ├─ <span id="ui.Label:new">Label :new</span>             (int x, int y, int width, int height, <span class="editable">[string text = ""]</span>)
│ │  └─ <span id="ui.Label:text">nil/string :text</span>       () <span class="comment">Gets/sets its text. </span>
│ │                └─          (string text) 
│ │    
│ │ 
│ ├─ <span class="editable" id="ui.Textbox">Textbox</span>
│ │  │
│ │  ├─ <span id="ui.Textbox:new">Textbox :new</span>           (int x, int y, int width, int height <span class="editable">[, string text = "" [, string placeholder = "" ]</span>])
│ │  ├─ <span id="ui.Textbox:onTextChanged">nil :onTextChanged</span>     (function onChange) <span class="comment">Arguments: sender</span>
│ │  ├─ <span id="ui.Textbox:readonly">nil/bool   :readonly</span>   () <span class="comment">Gets/sets its readonly state. </span>
│ │  │             └─          (string readonly) 
│ │  └─ <span id="ui.Textbox:text">nil/string :text</span>       () <span class="comment">Gets/sets its text. </span>
│ │                └─          (string text) 
│ │ 
│ │ 
│ └─ <span class="editable" id="ui.Window">Window</span>
│    │
│    ├─ Window :new            (int x, int y, int width, int height) <span class="comment">A container element for components. Set x/y to -1 to center.</span>
│    │ 
│    ├─ <span id="ui.Window:onInitialized">nil :onInitialized</span>     (function func) <span class="comment">=> Function listener for initialization. Callback has no arguments.</span>
│    ├─ <span id="ui.Window:onTick">nil :onTick</span>            (function func) <span class="comment">=> Every tick. Callback has no arguments.</span>
│    ├─ <span id="ui.Window:onExit">nil :onExit</span>            (function func) <span class="comment">=> When the window closes. Callback has no arguments.</span>
│    ├─ <span id="ui.Window:onTryOkay">nil :onTryOkay</span>         (function func) <span class="comment">=> </span>
│    ├─ <span id="ui.Window:onDraw">nil :onDraw</span>            (function func) <span class="comment">=> When the window is drawn.</span>
│    ├─ <span id="ui.Window:onMouseUp">nil :onMouseUp</span>         (function func) <span class="comment">=> Callback args: int x, int y, int button</span>
│    ├─ <span id="ui.Window:onMouseDown">nil :onMouseDown</span>       (function func) <span class="comment">=> Callback args: int x, int y, int button</span>
│    ├─ <span id="ui.Window:onMouseMove">nil :onMouseMove</span>       (function func) <span class="comment">=> Callback args: int x, int y, int dx, int dy</span>
│    ├─ <span id="ui.Window:onMouseWheel">nil :onMouseWheel</span>      (function func) <span class="comment">=> Callback args: int x, int y, int d</span>
│    ├─ <span id="ui.Window:onKeyPress">nil :onKeyPress</span>        (function func) <span class="comment">=> Callback args: int key, Uint16 character, bool shift, bool ctrl, bool alt</span>
│    ├─ <span id="ui.Window:onKeyRelease">nil :onKeyRelease</span>      (function func) <span class="comment">=> Callback args: int key, Uint16 character, bool shift, bool ctrl, bool alt</span>
│    ├─ <span id="ui.Window:onFocus">nil :onFocus</span>           (function func) <span class="comment">=> When receives focus. Callback has no arguments. </span>
│    ├─ <span id="ui.Window:onTick">nil :onBlur</span>            (function func) <span class="comment">=> When loses focus. Callback has no arguments.</span>
│    ├─ <span id="ui.Window:onTick">nil :onTryExit</span>         (function func) <span class="comment">=> When user attempts to exit the window. Callback has no arguments.</span>
│    ├─ <span id="ui.Window:onTick">nil :addComponent</span>      (Component c) <span class="comment">Adds a Component to the Window.</span>
│    └─ <span id="ui.Window:onTick">nil :removeComponent</span>   (Component c) <span class="comment">Removes a Component from the Window.</span>
│  
│  <span class="comment" id="bit">Bit API</span>
│  <span class="comment">Because Lua doesn't have one.</span>
│  
└ <span class="editable">bit</span>
  │ 
  ├─ <span id="bit.tobit">int tobit</span>                 (int input) <span class="comment">Normalize for binary operations. bit.* functions do it already.</span>
  ├─ <span id="bit.tohex">string tohex</span>              (int input, int length) <span class="comment">Generate a hex string from the input.</span>
  │ 
  ├─ <span id="bit.bnot">int bnot</span>                  (int input) <span class="comment">Performs bitwise NOT (~input)</span>
  ├─ <span id="bit.band">int band</span>                  (int... input) <span class="comment">Performs bitwise AND (input&amp;input) over all arguments.</span>
  ├─ <span id="bit.bor">int bor</span>                   (int... input) <span class="comment">Performs bitwise OR (input|input) over all arguments. </span>
  ├─ <span id="bit.bxor">int bxor</span>                  (int... input) <span class="comment">Performs bitwise XOR (input^input) over all arguments. </span>
  │ 
  ├─ <span id="bit.lshift">int lshift</span>                (int input, int count) <span class="comment">Performs a leftwards bit shift (input &lt;&lt; count). </span>
  ├─ <span id="bit.rshift">int rshift</span>                (int input, int count) <span class="comment">Performs a rightwards bit shift (input &gt;&gt; count). </span>
  ├─ <span id="bit.arshift">int arshift</span>               (int input, int count) <span class="comment">Performs a rightwards arithmetic bit shift (input &gt;&gt;&gt; count). </span>
  │ 
  ├─ <span id="bit.rol">int rol</span>                   (int input, int count) <span class="comment">Rotates a bit right by count bits. </span>
  ├─ <span id="bit.ror">int ror</span>                   (int input, int count) <span class="comment">Rotates a bit right by count bits. </span>
  │ 
  └─ <span id="bit.bswap">int bswap</span>                 (int input) <span class="comment">Swaps endianness of the number.</span>







<span class="editable" id="property">Lua Property API</span>
----------------

An element has many properties as seen above in the tpt.parts[] array definition. 
I've copied the list below for reference.

Elements
~~~~~~~~

* Note: mul stands for multiplier. Used to determine the end result by
  multiplying it to the determined one before application.
* A range [0:x] without a second element [0:] means it can go on however much.

* Check out <a href="#properties">the properties reference</a> for what each of these
  does.

<span class="editable" id="tpt.el">tpt.el.[inst].*</span>
  │
  ├─ <span id="tpt.el.name">char[4] name</span>
  ├─ <span id="tpt.el.color">int color</span>
  ├─ <span id="tpt.el.advection">float advection</span>
  ├─ <span id="tpt.el.airdrag">float airdrag</span>
  ├─ <span id="tpt.el.airloss">float airloss</span>
  ├─ <span id="tpt.el.loss">float loss</span>
  ├─ <span id="tpt.el.collision">float collision</span>
  ├─ <span id="tpt.el.gravity">float gravity</span>
  ├─ <span id="tpt.el.diffusion">float diffusion</span>
  ├─ <span id="tpt.el.hotair">float hotair</span>
  ├─ <span id="tpt.el.falldown">int falldown</span>
  ├─ <span id="tpt.el.flammable">int flammable</span>
  ├─ <span id="tpt.el.explosive">int explosive</span>
  ├─ <span id="tpt.el.meltable">boolint meltable</span>
  ├─ <span id="tpt.el.hardness">int hardness</span>
  ├─ <span id="tpt.el.menu">boolint menu</span>
  ├─ <span id="tpt.el.enabled">boolint enabled</span>
  ├─ <span id="tpt.el.weight">int weight</span>
  ├─ <span id="tpt.el.menusection">int menusection</span>
  ├─ <span id="tpt.el.heat">float heat</span>
  ├─ <span id="tpt.el.hconduct">int hconduct</span>
  ├─ <span id="tpt.el.state">int state</span>
  ├─ <span id="tpt.el.properties">int properties</span>
  └─ <span id="tpt.el.description">string description</span>

<span class="comment">Element transitions - check out <a href="#transitions">#transitions</a></span>
<span class="editable" id="tpt.eltransition">tpt.eltransition.[inst].*</span>
  │
  ├─ <span id="tpt.eltransition.presHighValue">presHighValue</span>
  ├─ <span id="tpt.eltransition.presHighType">presHighType</span>
  ├─ <span id="tpt.eltransition.presLowValue">presLowValue</span>
  ├─ <span id="tpt.eltransition.presLowType">presLowType</span>
  ├─ <span id="tpt.eltransition.tempHighValue">tempHighValue</span>
  ├─ <span id="tpt.eltransition.tempHighType">tempHighType</span>
  ├─ <span id="tpt.eltransition.tempLowValue">tempLowValue</span>
  └─ <span id="tpt.eltransition.tempLowType">tempLowType</span>

<span class="comment">All sorts of properties - check out <a href="#properties">#properties</a></span>
<span class="editable" id="elements.property">elements.property(*</span>
  │  
  ├─ <span id="elements.property.Name">string Name</span>
  ├─ <span id="elements.property.Colour">int Colour/Color</span>
  ├─ <span id="elements.property.MenuVisible">boolint MenuVisible</span>
  ├─ <span id="elements.property.MenuSection">int MenuSection</span>
  ├─ <span id="elements.property.Advection">float Advection</span>
  ├─ <span id="elements.property.AirDrag">float AirDrag</span>
  ├─ <span id="elements.property.AirLoss">float AirLoss</span>
  ├─ <span id="elements.property.Loss">float Loss</span>
  ├─ <span id="elements.property.Collision">float Collision</span>
  ├─ <span id="elements.property.Gravity">float Gravity</span>
  ├─ <span id="elements.property.Diffusion">float Diffusion</span>
  ├─ <span id="elements.property.HotAir">float HotAir</span>
  ├─ <span id="elements.property.Falldown">int Falldown</span>
  ├─ <span id="elements.property.Flammable">boolint Flammable</span>
  ├─ <span id="elements.property.Explosive">int Explosive</span>
  ├─ <span id="elements.property.Meltable">boolint Meltable</span>
  ├─ <span id="elements.property.Hardness">float Hardness</span>
  ├─ <span id="elements.property.Weight">int Weight</span>
  ├─ <span id="elements.property.Temperature">int Temperature</span>
  ├─ <span id="elements.property.HeatConduct">int HeatConduct</span>
  ├─ <span id="elements.property.Description">string Description</span>
  ├─ <span id="elements.property.State">int State</span>
  ├─ <span id="elements.property.Properties">int Properties</span>
  │  <span class="comment">element transition related stuff - melting, freezing, pressure ...</span>
  ├─ <span id="elements.property.LowPressure">int LowPressure</span> 
  ├─ <span id="elements.property.LowPressureTransition">element LowPressureTransition</span>
  ├─ <span id="elements.property.HighPressure">int HighPressure</span> 
  ├─ <span id="elements.property.HighPressureTransition">element HighPressureTransition</span>
  ├─ <span id="elements.property.LowTemperature">int LowTemperature</span> 
  ├─ <span id="elements.property.LowTemperatureTransition">element LowTemperatureTransition</span>
  ├─ <span id="elements.property.HighTemperature">int HighTemperature</span> 
  ├─ <span id="elements.property.HighTemperatureTransition">element HighTemperatureTransition</span>
  ├─ <span id="elements.property.Update">function(int index, int x, int y, int surround_space, int nt) Update</span>
  └─ <span id="elements.property.Graphics">function(int index, int colr, int colg, int colb) Graphics</span>


<span class="editable" id="particles">Particles</span>
~~~~~~~~~

(particle)
  │
  ├─ <span id="particles.type">int type</span>      <span class="comment">which element type is this?</span>
  ├─ <span id="particles.life">int life</span>      <span class="comment">commonly used on various elements to induce timed death - can be set to automatically decrease</span>
  ├─ <span id="particles.ctype">int ctype</span>     <span class="comment">commonly used as the "underlying type" of various elements like SPRK's original metal</span>
  ├─ <span id="particles.x">float x</span>       <span class="comment">the element's X coordinate</span>
  ├─ <span id="particles.y">float y</span>       <span class="comment">the element's X coordinate</span>
  ├─ <span id="particles.vx">float vx</span>      <span class="comment">the element's horizontal speed (&gt;0 = right, &lt;0 = left)</span>
  ├─ <span id="particles.vy">float vy</span>      <span class="comment">the element's vertical speed (&gt;0 = right, &lt;0 = left)</span>
  ├─ <span id="particles.temp">float temp</span>    <span class="comment">the element's temperature in kelvins (displayed - 273.15)</span>
  ├─ <span id="particles.pavg">float pavg[2]</span> <span class="comment">magic</span>
  ├─ <span id="particles.flags">int flags</span>     <span class="comment">special flags that aren't saved - stuff like FLAG_STAGNANT</span>
  ├─ <span id="particles.tmp">int tmp</span>       <span class="comment">generic use integer for an element - used lots for usage modes like FILT filter modes</span>
  ├─ <span id="particles.tmp2">int tmp2</span>      <span class="comment">another generic use integer for an element - things like EXOT use it as colour storage</span>
  └─ <span id="particles.dcolour">unsigned int dcolour</span> <span class="comment">the colour of the decorations drawn onto it: 0xAARRGGBB</span>




<span id="properties">Properties (detailed)</span>
----------

This is kind of a detailed listing for absolutely _everything_ a sim->elements reference 
contains. Check it out! (This used to be the property-reference page. Merged it here. Take 
that, bandwidth.)

<span class="comment nodash">// Element's name on the new Lua API
// You'll set this manually anyways with Lua when allocating an element.
// ( elements.allocate("DEFAULT", "BCOL") )</span>
<span id="properties.Identifier">Identifier</span> = "<span class="editable">DEFAULT_PT_BCOL</span>"; 

<span class="comment nodash">// Your element's actual name. Unrelated to the Identifier.
// This will be used in the !... command interface as well.</span>
<span id="properties.Name">Name</span> = "<span class="editable">BCOL</span>";

<span class="comment nodash">
// This will be your menu colour as well as the particle's default color in Nothing View.
// Format: 0x<span style="color: red">RR</span><span style="color: green">GG</span><span style="color: blue">BB</span>
// Note: the Lua API has a quirk: 
// pass 0xAA<span style="color: red">RR</span><span style="color: green">GG</span><span style="color: blue">BB</span> for elements.property (AA is "alpha" or opacity), 
// but it is used as 0x<span style="color: red">RR</span><span style="color: green">GG</span><span style="color: blue">BB</span>AA as the element menu icon
// and 0xRRGGBBAA as the particle's colour.</span>
<span id="properties.Colour">Colour</span> = PIXPACK(0x<span class="editable">333333</span>); 

<span class="comment nodash">// Whether or not it's in a menu.
// If you're making an element you want unattainable unless by reactions or console magic, then set
// this to 0.
// Note, doesn't disable setting the brush with middle-clicking this particle.</span>
<span id="properties.MenuVisible">MenuVisible</span> = <span class="editable">1</span>;

<span class="comment nodash">// Which menu section (see <a href="#elem.SC_WALL">the list of menus</a>) it's under. 
// Lua folks have SC_* under elements.*</span>
<span id="properties.MenuSection">MenuSection</span> = SC_<span class="editable">POWDERS</span>; 

<span class="comment nodash">// This toggles the entire element on and off. 
// Probably used to have removed elements still occupy some space for compatibility's sake.
// Literally disables the element from being used if 0.</span>
<span id="properties.Enabled">Enabled</span> = <span class="editable">1</span>;

<span class="comment nodash">// How much the particle is pushed by moving air. 
// Normally 0 for solids, and up to 1 for other elements. 
// It can be negative, ANAR and DEST do this so it goes towards pressure</span>
<span id="properties.Advection">Advection</span> = <span class="editable">0.4f</span>; 

<span class="comment nodash">// How much air the particle "drags" along with itself when moving.
// CFDS is some magic to make it work with different pressure grid sizes.
// #define CFDS  (4.0f/CELL)</span>
<span id="properties.AirDrag">AirDrag</span> = <span class="editable">0.04f</span> * CFDS; 

<span class="comment nodash">// How much it reduces velocity. 1 for no effect, 0 for full effect.
// Note: TTAN is not powered by this, nor will your other elements work with this.
// Also note that very fast-moving pressure can jump over grid spaces.</span>
<span id="properties.Identifier">AirLoss</span> = <span class="editable">0.94f</span>; 

<span class="comment nodash">// How much speed the particle loses every frame. 1 = no loss. 0.5 = half loss.</span>
<span id="properties.Loss">Loss</span> = <span class="editable">0.95f</span>; 

<span class="comment nodash">// When this particle hits something, this value is used to determine new velocity.</span>
<span id="properties.Collision">Collision</span> = <span class="editable">-0.1f</span>; 

<span class="comment nodash">// How fast the particle falls. Negative means it floats. </span>
<span id="properties.Gravity">Gravity</span> = <span class="editable">0.3f</span>; 

<span class="comment nodash">// How much the particle wiggles like GAS.</span>
<span id="properties.Diffusion">Diffusion</span> = <span class="editable">0.00f</span>; 

<span class="comment nodash">//How much the particle increases the pressure by. 
// Another property only for gasses, but VENT/VACU have theirs at (-)0.010f. 
// An extremely small number, sometimes as small as 0.000001f
// ICE has this as a negative value - it slightly reduces pressure when sitting still.</span>
<span id="properties.HotAir">HotAir</span> = <span class="editable">0.000f</span>  * CFDS; 

<span class="comment nodash">// Sets what kind of default moving code this particle will use.
// 0 = Solid (use this as well when you don't want any default moving code)
// 1 = Powder
// 2 = Liquid</span>
<span id="properties.Falldown">Falldown</span> = <span class="editable">1</span>; 

<span class="comment nodash">// How well this particle catches on fire.
// Affects the rate of FIRE absorbing it and producing more fire.
// 0 is unflammable, and onward from there it burns even better.</span>
<span id="properties.Flammable">Flammable</span> = <span class="editable">0</span>; 

<span class="comment nodash">// Sets default behaviour on if and how this element explodes.
// Explosion, in this case, is just turning into fire very quickly and making pressure.
// 0 = no default explosion behavior.
// 1 = Explodes with fire.
// 2 = Explodes with &gt;2.5 pressure as well as fire.
// You can always use 0 and implement your own explosive behavior.</span>
<span id="properties.Identifier">Explosive</span> = <span class="editable">0</span>; 

<span class="comment nodash">// Does it melt into LAVA?</span>
<span id="properties.Meltable">Meltable</span> = <span class="editable">5</span>; 

<span class="comment nodash">// How well acid affects this particle.
// 0 = not at all.
// &gt;0 = increasingly more.</span>
<span id="properties.Hardness">Hardness</span> = <span class="editable">2</span>; 

<span class="comment nodash">// Particle weight. Replaces the ages-old "which sinks below which" table. 
// Elements with larger values sink below elements with smaller values.
// Use any integer value really. Below is an estimate to which range TPT's 
// default elements' weights belong.
//     1 = gasses.
//     2 = very light powders. DUST?
//  0-49 = liquids.
// 50-99 = default powders.
//   100 = solids.
//    -1 = energy particles (PHOT/NEUT/ELEC/PROT).</span>
<span id="properties.Weight">Weight</span> = <span class="editable">90</span>; 

<span class="comment nodash">// How hot does it spawn with? 
// (In Kelvin)
// (except, in C++, you have the magic of addition)
// #define R_TEMP 22.0f</span>
<span id="properties.Temperature">Temperature</span> = <span class="editable">R_TEMP + 0.0f + 273.15f</span>; 

<span class="comment nodash">// How well the particle transfers heat.
// From 0 to 255 inclusive.
// INSL and FRME have this as 0. 
// INSL/INST/HSWC and a few more have 251 which is awesomely good.</span>
<span id="properties.HeatConduct">HeatConduct</span> = <span class="editable">150</span>; 

<span class="comment nodash">// The element's description.
// It's displayed as text in the bottom right when you point the mouse at an
// element button.</span>
<span id="properties.Description">Description</span> = "<span class="editable">Broken Coal. Heavy particles. See COAL</span>";

<span class="comment nodash">// Which state the element is in. 
// The only place that seems to use it is STKM, and it detects solids to spark.
// Just a convention thing it seems...?
// ST_NONE = Special types 
// ST_SOLID = Solid
// ST_LIQUID = Liquid 
// ST_GAS = Gas</span> 
<span id="properties.State">State</span> = ST_<span class="editable">SOLID</span>; 

<span class="comment nodash">// All sorts of element properties
// See <a href="#elem.PROP_CONDUCTS">the property listing.</a>
// Most of the properties there SHOULD make sense.
// See <a href="http://tpt.io/.213774">this forum post</a> on how to apply these with the Lua API.
// Here, just pick any bunch of properties you want and use the binary OR operator
// "|" on them. So TYPE_PART | PROP_NEUTPENETRATE is completely valid.</span>
<span id="properties.Properties">Properties</span> = <span class="editable">TYPE_PART</span>;


<span class="comment nodash" id="transitions">
/*
  So this next part is about transitions. 
  How this works is, you have to tell TPT about your upper and lower threshold
  and the elements it'll change to when the threshold is met.
  There's also a few predefined elements for when you don't want transitions: 
  unreachable levels of pressure and temperature which will never trigger a 
  transition as well as an element for No Type.

  IPL = Impossibly Low Pressure (That Never Will Be Reached)
  IPH = Impossibly High Pressure
  NT = No Type Whatsoever
  ITL = Impossibly Low Temperature
  ITH = Impossibly High Temperature
*/</span>

<span class="comment nodash">// if pressure is lower than this then change to LowPressureTransition</span>
<span id="properties.LowPressure">LowPressure</span> = <span class="editable" contentEditable="true">IPL</span>;
<span id="properties.LowPressureTransition">LowPressureTransition</span> = <span class="editable" contentEditable="true">NT</span>;

<span class="comment nodash">// if pressure is higher than this then change to HighPressureTransition</span>
<span id="properties.HighPressure">HighPressure</span> = <span class="editable" contentEditable="true">IPH</span>; 
<span id="properties.HighPressureTransition">HighPressureTransition</span> = <span class="editable" contentEditable="true">NT</span>;

<span class="comment nodash">// if temperature is higher than this then change to HighTemperatureTransition</span>
<span id="properties.LowTemperature">LowTemperature</span> = <span class="editable" contentEditable="true">ITL</span>;
<span id="properties.LowTemperatureTransition">LowTemperatureTransition</span> = <span class="editable" contentEditable="true">NT</span>;

<span class="comment nodash">// if temperature is lower than this then change to LowTemperatureTransition</span>
<span id="properties.HighTemperature">HighTemperature</span> = <span class="editable" contentEditable="true">ITH</span>;
<span id="properties.HighTemperatureTransition">HighTemperatureTransition</span> = <span class="editable" contentEditable="true">NT</span>;

<span class="comment nodash">// address of the update function, 99% of the time it's Element_YOURELEMENT::update</span>
<span id="properties.Update">Update</span> = &amp;Element_<span class="editable" contentEditable="true">BCOL</span>::update;

<span class="comment nodash">// address of the graphics function. 50% of the time you won't need it, 
// and 50% of the time all the time you will have it as Element_YOURELEMENT::graphics</span>
<span id="properties.Graphics">Graphics</span> = &amp;Element_<span class="editable" contentEditable="true">BCOL</span>::graphics; 



<span id="properties.graphics_func">Element graphics function reference</span>
-----------------------------------

(wow, what a long and clunky name!)

For how this works in Lua, you are passed four variables and expected to 
return a dozen more.

Parameters: index, colr, colg, colb
Return values: cache, pixel_mode, cola, colr, colg, colb, firea, firer, 
               fireg, and fireb.

The cache variable tells the graphics renderer not to call this function any-
more, since the color won't change anyway. Aside that, all properties are the 
same as what C++ should have them.

In C++ however, you are passed pointers with all the values to be returned. 
Bluntly assign to them as you would to any other pointer.

*colr = 255;

Also check out all the different arguments you will get as your function
parameters.

#define GRAPHICS_FUNC_ARGS Renderer * ren, Particle *cpart, int nx, int ny, 
     int *pixel_mode, int *cola, int *colr, int *colg, 
     int *colb, int *firea, int *firer, int *fireg, int *fireb

<span class="editable">ren</span> contains a reference to your local neighbourhood renderer, 
<span class="editable">cpart</span> your current particle (you can do stuff like cpart->life!), 
<span class="editable">nx</span> and <span class="editable">ny</span> to the particle's actual position (x and y),
<span class="editable">pixel_mode</span> to any extra effects the pixel may be subject to,
<span class="editable">cola</span>, <span class="editable">colr</span>, <span class="editable">colg</span> and <span class="editable">colb</span> represent the element's Colour property (alpha, 
red, green and blue) at first, but should be modified to the end result's 
colour, 
<span class="editable">firea</span>, <span class="editable">firer</span>, <span class="editable">fireg</span> and <span class="editable">fireb</span> represent the fiery glow's colour, if the 
element has a fiery glow pixel mode applied, as alpha, red, green and blue.


<span id="properties.pixel_mode">Pixel modes</span>
-----------

There's a handy <a href="http://powdertoy.co.uk/Wiki/W/File:Particle_Drawing_Modes.png.html">pixel mode image</a> on the wiki, so definitely
check it out!

Also note that PRTI/PRTO effects cannot be applied without some witchcraft applied to the ctype 
and life values of the element. Check out Renderer::render_parts if really interested.

pixel_mode
  │
  │ <span class="comment nodash">Prevents anything from being drawn. Kinda like WARP.</span>
  ├─ PMODE_NONE     <span class="editable">0x00000000</span>
  │ <span class="comment nodash">Draw an opaque pixel, aka transparency is not applied.</span>
  ├─ PMODE_FLAT     <span class="editable">0x00000001</span>
  │ <span class="comment nodash">Adds a blobby effect, like you were using blob (5) display mode</span>
  ├─ PMODE_BLOB     <span class="editable">0x00000002</span>
  │ <span class="comment nodash">Liquids in Fancy display apply this. Adds a blur and makes the pixels remain sharp as well.</span>
  ├─ PMODE_BLUR     <span class="editable">0x00000004</span>
  │ <span class="comment nodash">Plain ol' glow. Stuff like ARAY (In fancy display) use this.</span>
  ├─ PMODE_GLOW     <span class="editable">0x00000008</span>
  │ <span class="comment nodash">Kinda dim PMODE_FLARE - GBMB uses this - beams running horizontally and vertically + glow to emphasize brightness</span>
  ├─ PMODE_SPARK    <span class="editable">0x00000010</span>
  │ <span class="comment nodash">Regularly bright PMODE_FLARE - BOMB uses this - beams running horizontally and vertically</span>
  ├─ PMODE_FLARE    <span class="editable">0x00000020</span>
  │ <span class="comment nodash">Large and super bright PMODE_FLARE - DEST is the only thing using this.</span>
  ├─ PMODE_LFLARE   <span class="editable">0x00000040</span>
  │ <span class="comment nodash">This adds some magic to the equation to make multiple layered particles add up to be brighter than one particle alone.</span>
  ├─ PMODE_ADD      <span class="editable">0x00000080</span>
  │ <span class="comment nodash">Even more magical than PMODE_ADD, somehow better for OpenGL? </span>
  ├─ PMODE_BLEND    <span class="editable">0x00000100</span>
  │ <span class="comment nodash">Something very STKM specific that won't work anywhere except on STKM</span>
  ├─ PSPEC_STICKMAN <span class="editable">0x00000200</span>
  │ <span class="comment nodash">Disables decorations on this element (LCRY does this as well as some magic to paint itself colours)</span>
  ├─ NO_DECO        <span class="editable">0x00001000</span>
  │ <span class="comment nodash">The fire/blurriness colors get decorations too. Gasses might use this.</span>
  ├─ DECO_FIRE      <span class="editable">0x00002000</span>
  │ <span class="comment nodash">Adds fire colors around the element (although weak ones - LAVA and LIGH lines use that)</span>
  ├─ FIRE_ADD       <span class="editable">0x00010000</span> -- adds a weak fire effect around the element (ex. LAVA/LIGH)
  │ <span class="comment nodash">Adds more impressive fire colors around the element. Gasses use this for their coloring.</span>
  ├─ FIRE_BLEND     <span class="editable">0x00020000</span>
  │ <span class="comment nodash">PRTI/PRTO effect flags: note that they need magic life/ctype variables!</span>
  ├─ EFFECT_GRAVIN  <span class="editable">0x01000000</span>
  └─ EFFECT_GRAVOUT <span class="editable">0x02000000</span>

<span id="properties.update_func">Update functions</span>
================

Update functions are a brilliant thing - they're in short <strong>everything
your element does aside fancy looks</strong>. This includes reactions, moving
(in a non-powder and non-liquid way) and everything else you can think of!
They're fairly simple to implement, too.

In C++, the function signature for an update function is 
<span class="editable">int update(Simulation* sim, int index, int x, int y, int surround_space, 
           int nt, Particle *parts, int pmap[YRES][XRES]);</span> 

...and in Lua the pseudo-signature (not valid Lua) of the function is 
<span class="editable">int update(int index, int x, int y, int surround_space, int nt)</span> 

You can implement the function yourself and then assign it to your element's <a href="#elements.property.Update">Update</a> 
property. Inside the function you can do pretty much everything, but most users 
actually use the function to do stuff relating to our element :)

Now to the passed arguments.

<span class="editable" id="properties.update_func.sim">*sim</span>
is a reference to the Simulation object - your gateway to doing stuff inside the
simulation but outside the actual particle data - placing rectangles, creating
particles, reloading saves, everything really. Custom properties that you want
to save will be attached to the simulation too. Portals keep their inner guts in
this. See <a href="#simulation">#sim</a> for what you get to do inside a
simulation object. This pointer is irrelevant in Lua since the script always has
access to the simulation anyway.

<span class="editable" id="properties.update_func.index">index</span>
is the particle's (the one which we are currently doing  the update thing for)
index. Particles in TPT are stored in an array and as such are assigned an ID
relating to their position in the array. This index has  nothing to do with the
actual x/y coordinates or any other property of the  particle, but is an easy
and reliable way to refer directly to a single particle in other function calls.

<span class="editable" id="properties.update_func.xy">x, y</span>
are the X and Y coordinates of the particle. Super simple stuff.

<span class="editable" id="properties.update_func.surround_space">surround_space</span>
is a magic integer which tells us how many  empty squares are directly around
this particle. The 'directly around' can also be  called the Moore
neighbourhood.

<span class="editable" id="properties.update_func.nt">nt</span>
is another magic integer which tells you how  many squares 'directly around'
this particle are of a different type. So if you  have two of the same
particles, four empty spaces and two random particles in  your 'directly around'
you will have an 'nt' of 2.

<span class="editable" id="properties.update_func.parts">*parts</span>
reference to the giant array of all particles that currently exist on the
screen. Every object in there is of the type span class="editable">struct
Particle/span> which you can read about <a href="#particles">here.</a> You can
access it in Lua via <a href="#sim.parts">sim.parts</a>.

<span class="editable" id="properties.update_func.pmap">*pmap</span>
is a reference to the two-dimensional array of a kind of integer that at the
same time contains both the type and the index of the particle on a given y, x
position. It's useful for looping around the 'directly around' of a particle and
finding out types and indexes of the particles. You can access this variable via
Lua in <a href="#sim.pmap">sim.pmap.</a>

Its magic resides in that it has two variables inside: the <span class="color y">index</span> and the <span class="color r">type</span>. 
Its bits look something like this:  

<span class="color y">00000000 00001001 10100101</span> <span class="color r">00010010</span>

so getting the type out is as simple as cutting off the <span class="color y">index</span> and leaving the <span class="color r">type</span>. 

In C++ you can do that with <span class="editable">pmap[y][x] &amp; 0xFF</span>, which ANDs the bits together, 
leaving only the <span class="color r">type</span> byte.

In Lua you can do that with <span class="editable">bit.band(sim.pmap(x, y), 0xFF)</span>.

You can get the index the other way around - moving the index back into position
where it should be if it was a normal integer, starting from where the type
starts, not halfway across the value! 
In C++ you can shift it back right with <span class="editable">pmap[y][x] >> 8</span> and
in Lua you do that with <span class="editable">bit.rshift(sim.pmap(x, y), 8)</span>.

So if you wanted to get the type of the particle at the coordinates (150, 300)
you could access pmap[300][150] in order to get the compound variable, then
cutting out only the first 8 bytes via bitwise AND to leave only the type. This
process produces the code pmap[300][150] &amp; 0xFF.

<span id="properties.update_func.returns">Returning</span>
---------

The update function also can return an integer value which can tell the
Simulation's update code to delete the particle right afterward. (Actually,
there should always be a return, but the C++ language is pretty relaxed on the
subject and assumes we returned a 0 if we actually didn't return anything)

If you return a 1 from the code, this means that the particle did something
during the update that now means the particle is going to be deleted, and then
the actual update-function-calling-function will delete your particle for you.

The same thing also applies for Lua.

</code></pre>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>
  $(".content > [id]").hover(function(evt) {
    var scr = $(document.body).scrollTop();
    document.location.hash = '#' + evt.target.id;
    $(document.body).scrollTop(scr);
  });
  $("#bright").click(function(){$(document.body).toggleClass('bright');});
  
  if (localStorage && 
        localStorage.tptelements_font !== undefined && 
        localStorage.tptelements_font !== '') {
      document.body.style.fontFamily = localStorage.tptelements_font;
    } 
</script>
</body>
</html>